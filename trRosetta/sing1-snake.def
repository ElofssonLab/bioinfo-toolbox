Bootstrap: docker
From: tensorflow/tensorflow:1.13.2-gpu-py3


%files
PyRosetta4.Release.python36.ubuntu.release-258.tar.bz2 /home
DockQ /home

%post
apt-get update
apt-get autoremove
apt-get autoclean
DEBIAN_FRONTEND=noninteractive apt-get install keyboard-configuration ipython3 wget -y
DEBIAN_FRONTEND=noninteractive apt-get install python3-pandas python3-matplotlib python3-seaborn python3-sklearn -y
apt install cuda -y --fix-missing

pip install biopython snakemake

wget http://zhanglab.ccmb.med.umich.edu/TM-align/TMalign.gz
gzip -d TMalign.gz
chmod +x TMalign
mv TMalign /usr/bin

cd /home/DockQ
make
cd ..

tar -vjxf /home/PyRosetta4.Release.python36.ubuntu.release-258.tar.bz2
pip install -e PyRosetta4.Release.python36.ubuntu.release-258/setup/

# THis is the command that worked for me as I run out of disk space on /tmp
# sudo su -c "SINGULARITY_TMPDIR=/home/arnee/Downloads/tmp/  SINGULARITY_DISABLE_CACHE=true SINGULARITY_CACHE=/home/arnee/Downloads/tmp/ singularity build /home/arnee/singularity-images/trRosetta-gpu.simg sing1-gpu.def"
